<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="M0B1Li7Y: a fast, offline-capable 12-minute mobility routine." />
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" href="./icons/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="./icons/icon.svg" />
    <link rel="stylesheet" href="./styles.css" />
    <title>M0B1Li7Y</title>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="header-brand">
          <h1 class="header-title">ğŸ’ª M0B1Li7Y</h1>
          <p class="header-subtitle">Daily Mobility</p>
        </div>
        <button id="mute-toggle" class="icon-btn" aria-label="Toggle sound">ğŸ”Š</button>
      </header>

      <div id="update-banner" class="update-banner" hidden aria-live="polite">
        <span>âœ¨ New version available</span>
        <div class="update-actions">
          <button id="reload-btn" class="control-btn control-btn--primary">Reload</button>
          <button id="dismiss-update" class="control-btn">Later</button>
        </div>
      </div>

      <main class="main-content">
        <!-- ROUTINE VIEW -->
        <section id="routine-view" class="view active" aria-label="Routine">
          <!-- Progress Ring -->
          <div class="progress-container">
            <div class="progress-ring-wrapper">
              <svg class="progress-ring" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" class="progress-ring-bg"></circle>
                <circle cx="50" cy="50" r="45" class="progress-ring-fg" id="progress-ring"></circle>
              </svg>
              <div class="progress-text">
                <div class="timer large-timer" id="timer">00:30</div>
                <p class="step-progress" id="step-progress">Step 1 of 12</p>
              </div>
            </div>
          </div>

          <!-- Hero Card with Image -->
          <div class="hero-card">
            <div class="media-frame media-frame--hero" id="media-frame">
              <img id="step-image" alt="" loading="lazy" />
              <div id="image-fallback" class="image-fallback" hidden aria-hidden="true"></div>
            </div>
            <div class="card-overlay">
              <h2 id="step-name" class="hero-title">Arm circles</h2>
              <p id="step-cue" class="hero-cue">Keep shoulders relaxed and smooth.</p>
            </div>
          </div>

          <!-- Info Cards Grid -->
          <div class="cards-grid">
            <div class="info-card info-card--blue">
              <div class="card-icon">â±ï¸</div>
              <div class="card-content">
                <p class="card-label">Duration</p>
                <p class="card-value">~12 min</p>
              </div>
            </div>
            <div class="info-card info-card--green">
              <div class="card-icon">ğŸ§˜</div>
              <div class="card-content">
                <p class="card-label">Type</p>
                <p class="card-value">Mobility</p>
              </div>
            </div>
          </div>

          <!-- Untimed hint -->
          <div id="untimed-hint" class="untimed-hint" hidden>
            <span class="hint-icon">âœ‹</span> Tap Done when finished
          </div>

          <!-- Walk Picker -->
          <div class="walk-picker" id="walk-picker" hidden>
            <h3 class="walk-title">Choose walk duration</h3>
            <div class="walk-options">
              <button data-mins="3" class="walk-btn">ğŸš¶ 3 min</button>
              <button data-mins="4" class="walk-btn">ğŸš¶ 4 min</button>
              <button data-mins="5" class="walk-btn">ğŸš¶ 5 min</button>
            </div>
          </div>

          <!-- Control Buttons -->
          <div class="button-grid">
            <div class="start-controls controls-section" id="start-controls">
              <button id="start-btn" class="control-btn control-btn--primary control-btn--large">
                <span class="btn-icon">â–¶ï¸</span> Start Routine
              </button>
            </div>

            <div class="primary-controls controls-section" id="run-controls" hidden>
              <button id="back-btn" class="control-btn control-btn--secondary">
                <span>â¬…ï¸</span>
              </button>
              <button id="pause-btn" class="control-btn control-btn--primary control-btn--flex">
                <span class="btn-icon">â¸ï¸</span> Pause
              </button>
              <button id="next-btn" class="control-btn control-btn--secondary">
                <span>â¡ï¸</span>
              </button>
            </div>

            <div class="done-controls controls-section" id="done-controls" hidden>
              <button id="done-btn" class="control-btn control-btn--primary control-btn--large" hidden>
                <span class="btn-icon">âœ…</span> Done
              </button>
            </div>
          </div>

          <p class="image-credit" id="image-credit" hidden>
            Illustrations by
            <a id="image-credit-link" target="_blank" rel="noopener noreferrer">Bend</a>
          </p>
        </section>

        <!-- HISTORY VIEW -->
        <section id="history-view" class="view" aria-label="History" hidden>
          <div class="section-header">
            <h2 class="section-title">ğŸ“Š History</h2>
            <p id="streak" class="streak-badge">Streak: 0 days</p>
          </div>
          <div class="history-card">
            <ul id="history-list" class="history-list"></ul>
          </div>
        </section>

        <!-- SETTINGS VIEW -->
        <section id="settings-view" class="view" aria-label="Settings" hidden>
          <div class="section-header">
            <h2 class="section-title">âš™ï¸ Settings</h2>
          </div>

          <fieldset class="settings-group">
            <legend class="settings-legend">ğŸ”Š Cues</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="sound-enabled" checked />
              <span>Sound cues</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="haptics-enabled" checked />
              <span>Haptic cues</span>
            </label>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">ğŸš¶ Routine defaults</legend>
            <label class="select-label">
              Default walk duration
              <select id="default-walk-duration">
                <option value="3">3 minutes</option>
                <option value="4">4 minutes</option>
                <option value="5">5 minutes</option>
              </select>
            </label>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">ğŸ–¼ï¸ Images</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="remote-image-caching" />
              <span>Cache exercise images for offline use</span>
            </label>
            <p class="setting-note">Keeps images available after first load but uses extra device storage.</p>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">ğŸ¨ Theme</legend>
            <label class="select-label">
              Theme
              <select id="theme-select">
                <option value="default">Default</option>
                <option value="blue">Blue</option>
                <option value="emerald">Emerald</option>
                <option value="rose">Rose</option>
              </select>
            </label>
            <span id="theme-swatch" class="theme-swatch" aria-hidden="true" title="Theme preview"></span>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">ğŸ‘¨â€ğŸ’» Developer</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="disable-sw" />
              <span>Disable service worker (bypass cache)</span>
            </label>
            <p class="setting-note">Enable this to unregister the service worker for testing.</p>
          </fieldset>
        </section>
      </main>

      <!-- Bottom Navigation -->
      <nav class="bottom-nav" aria-label="Primary">
        <button data-view="routine-view" class="nav-btn active" title="Routine">
          <span class="nav-icon">ğŸ§˜</span>
          <span class="nav-label">Routine</span>
        </button>
        <button data-view="history-view" class="nav-btn" title="History">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">History</span>
        </button>
        <button data-view="settings-view" class="nav-btn" title="Settings">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-label">Settings</span>
        </button>
      </nav>
      <div id="update-toast" class="toast" hidden aria-live="polite"></div>
    </div>

    <!-- Temporary debug panel (toggle to view client errors and SW registrations) -->
    <div id="debug-panel" class="debug-panel" hidden aria-live="polite">
      <div class="debug-header">
        <strong>Debug</strong>
        <button id="debug-show-btn" class="control-btn">Show</button>
      </div>
      <pre id="debug-output" class="debug-output" hidden></pre>
    </div>

    <script type="module" src="./src/app.js"></script>
  </body>
</html>
