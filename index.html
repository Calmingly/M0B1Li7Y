<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="description" content="M0B1Li7Y: a fast, offline-capable 12-minute mobility routine." />
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" href="./icons/icon-192.png" sizes="192x192" type="image/png" />
    <link rel="icon" href="./icons/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="./icons/icon-192.png" />
    <link rel="stylesheet" href="./styles.css" />
    <title>M0B1Li7Y</title>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="header-brand">
          <h1 class="header-title">M0B1Li7Y</h1>
          <p class="header-subtitle">Daily Mobility ‚Ä¢ ~13 min</p>
        </div>
        <button id="mute-toggle" class="icon-btn icon-btn--sound" aria-label="Sound on" aria-pressed="true">
          <svg class="sound-icon sound-icon--on" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 10v4h4l5 4V6L7 10H3z"></path>
            <path d="M16 9a4 4 0 0 1 0 6"></path>
            <path d="M18.8 6.2a8 8 0 0 1 0 11.6"></path>
          </svg>
          <svg class="sound-icon sound-icon--off" viewBox="0 0 24 24" aria-hidden="true" hidden>
            <path d="M3 10v4h4l5 4V6L7 10H3z"></path>
            <path d="M16 8l5 8"></path>
            <path d="M21 8l-5 8"></path>
          </svg>
        </button>
      </header>

      <main class="main-content">
        <!-- ROUTINE VIEW -->
        <section id="routine-view" class="view active" aria-label="Routine">
          <!-- Progress Ring -->
          <div class="progress-container">
            <div class="progress-ring-wrapper">
              <svg class="progress-ring" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" class="progress-ring-bg"></circle>
                <circle cx="50" cy="50" r="45" class="progress-ring-fg" id="progress-ring"></circle>
              </svg>
              <div class="progress-text">
                <div class="timer large-timer" id="timer">00:30</div>
                <p class="step-progress" id="step-progress">Step 1 of 12</p>
              </div>
            </div>
          </div>

          <!-- Hero Card with Image -->
          <div class="hero-card">
            <div class="media-frame media-frame--hero" id="media-frame">
              <img id="step-image" alt="" loading="lazy" />
              <div id="image-fallback" class="image-fallback" aria-hidden="true">
                <span class="skeleton-bar"></span>
                <span class="skeleton-bar"></span>
              </div>
            </div>
            <div class="card-overlay">
              <h2 id="step-name" class="hero-title">Arm circles</h2>
              <p id="step-cue" class="hero-cue">Keep shoulders relaxed and smooth.</p>
            </div>
          </div>

          <!-- Walk Picker -->
          <div class="walk-picker" id="walk-picker" hidden>
            <h3 class="walk-title">Choose walk duration</h3>
            <div class="walk-options">
              <button data-mins="3" class="walk-btn">3 min</button>
              <button data-mins="4" class="walk-btn">4 min</button>
              <button data-mins="5" class="walk-btn">5 min</button>
            </div>
          </div>

          <!-- Control Buttons -->
          <div class="button-grid">
            <div class="start-controls controls-section" id="start-controls">
              <button id="start-btn" class="control-btn control-btn--primary control-btn--large">Start</button>
            </div>

            <div class="primary-controls controls-section" id="run-controls" hidden>
              <button id="back-btn" class="control-btn control-btn--secondary">Back</button>
              <button id="pause-btn" class="control-btn control-btn--primary control-btn--flex">Pause</button>
              <button id="next-btn" class="control-btn control-btn--secondary">Next</button>
            </div>

            <div class="done-controls controls-section" id="done-controls" hidden>
              <button id="done-btn" class="control-btn control-btn--primary control-btn--large" hidden>Done</button>
            </div>
          </div>

          <p class="image-credit" id="image-credit" hidden>
            Illustrations by
            <a id="image-credit-link" target="_blank" rel="noopener noreferrer">Bend</a>
          </p>
        </section>

        <!-- HISTORY VIEW -->
        <section id="history-view" class="view" aria-label="History" hidden>
          <div class="section-header">
            <h2 class="section-title">üìä History</h2>
            <p id="streak" class="streak-badge">Streak: 0 days</p>
          </div>
          <section class="history-group">
            <button id="history-summary-toggle" class="history-group-toggle" type="button" aria-expanded="true" aria-controls="history-summary-content">
              Summary
            </button>
            <div id="history-summary-content" class="history-group-content">
              <div class="history-stats" aria-label="Summary stats">
                <div class="history-stat">
                  <p class="history-stat-label">This week</p>
                  <p id="sessions-week" class="history-stat-value">0 sessions</p>
                </div>
                <div class="history-stat">
                  <p class="history-stat-label">Last 7 days</p>
                  <p id="minutes-week" class="history-stat-value">0 min</p>
                </div>
                <div class="history-stat">
                  <p class="history-stat-label">Current streak</p>
                  <p id="streak-summary" class="history-stat-value">0 days</p>
                </div>
              </div>
              <p id="goal-nudge" class="history-nudge">Complete your first routine.</p>
              <p id="milestone-progress" class="milestone-chip">Next milestone: 5 sessions (0/5)</p>
            </div>
          </section>

          <section class="history-group">
            <button id="history-add-toggle" class="history-group-toggle" type="button" aria-expanded="false" aria-controls="history-add-content">
              Add or edit day
            </button>
            <div id="history-add-content" class="history-group-content" hidden>
              <div class="history-add-day">
                <label class="history-editor-label" for="history-day-input">Select day</label>
                <div class="history-add-day-controls">
                  <input id="history-day-input" class="history-day-input" type="date" />
                  <button id="open-day-edit" class="control-btn control-btn--secondary">Open day</button>
                </div>
              </div>
            </div>
          </section>

          <section class="history-group">
            <button id="history-recent-toggle" class="history-group-toggle" type="button" aria-expanded="false" aria-controls="history-recent-content">
              Recent days
            </button>
            <div id="history-recent-content" class="history-group-content" hidden>
              <div class="history-card">
                <ul id="history-list" class="history-list is-loading" aria-busy="true">
                  <li class="history-skeleton" aria-hidden="true"></li>
                  <li class="history-skeleton" aria-hidden="true"></li>
                  <li class="history-skeleton" aria-hidden="true"></li>
                </ul>
              </div>
            </div>
          </section>

          <section class="history-group">
            <button id="history-editor-toggle" class="history-group-toggle" type="button" aria-expanded="false" aria-controls="history-editor-content">
              Day details
            </button>
            <div id="history-editor-content" class="history-group-content" hidden>
              <div id="history-editor" class="history-editor" hidden>
                <h3 id="history-editor-title" class="history-card-title">Edit day</h3>
                <p class="history-editor-label">Check completed pieces</p>
                <div class="history-quick-actions">
                  <button id="mark-all-day-edit" class="control-btn control-btn--secondary">Mark all</button>
                  <button id="clear-all-day-edit" class="control-btn control-btn--secondary">Clear all</button>
                  <button id="weekday-template-day-edit" class="control-btn control-btn--secondary">Mon‚ÄìFri template</button>
                </div>
                <div id="history-piece-list" class="history-piece-list"></div>
                <p id="pieces-value" class="history-editor-value">0 / 11 pieces</p>
                <div class="history-editor-actions">
                  <button id="save-day-edit" class="control-btn control-btn--primary">Save</button>
                  <button id="cancel-day-edit" class="control-btn control-btn--secondary">Cancel</button>
                  <button id="reset-day-edit" class="control-btn control-btn--secondary history-reset-btn">Reset day</button>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- SETTINGS VIEW -->
        <section id="settings-view" class="view" aria-label="Settings" hidden>
          <div class="section-header">
            <h2 class="section-title">‚öôÔ∏è Settings</h2>
          </div>

          <fieldset class="settings-group">
            <legend class="settings-legend">üîä Cues</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="sound-enabled" checked />
              <span>Sound cues</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="haptics-enabled" checked />
              <span>Haptic cues</span>
            </label>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">üö∂ Routine defaults</legend>
            <label class="select-label">
              Default walk duration
              <select id="default-walk-duration">
                <option value="3">3 minutes</option>
                <option value="4">4 minutes</option>
                <option value="5">5 minutes</option>
              </select>
            </label>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">üñºÔ∏è Images</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="remote-image-caching" />
              <span>Cache exercise images for offline use</span>
            </label>
            <p class="setting-note">Keeps images available after first load but uses extra device storage.</p>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">üé® Theme</legend>
            <label class="select-label">
              Theme
              <select id="theme-select">
                <option value="default">Default</option>
                <option value="blue">Blue</option>
                <option value="emerald">Emerald</option>
                <option value="rose">Rose</option>
                <option value="sunset">Sunset</option>
                <option value="midnight">Midnight</option>
                <option value="slate">Slate</option>
              </select>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="high-contrast-mode" />
              <span>High contrast mode</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="auto-high-contrast-night" />
              <span>Auto-enable high contrast at night</span>
            </label>
            <span id="theme-swatch" class="theme-swatch" aria-hidden="true" title="Theme preview"></span>
          </fieldset>

          <fieldset class="settings-group">
            <legend class="settings-legend">üë®‚Äçüíª Developer</legend>
            <label class="checkbox-label">
              <input type="checkbox" id="disable-sw" />
              <span>Disable service worker (bypass cache)</span>
            </label>
            <p class="setting-note">Enable this to unregister the service worker for testing.</p>
            <div class="perf-debug" aria-label="History performance debug">
              <p class="perf-debug-title">History debug</p>
              <p class="perf-debug-line">Render: <span id="history-render-ms">0.0 ms</span></p>
              <p class="perf-debug-line">Cache hit rate: <span id="history-cache-rate">0%</span></p>
            </div>
          </fieldset>
        </section>
      </main>

      <!-- Bottom Navigation -->
      <nav class="bottom-nav" aria-label="Primary">
        <button data-view="routine-view" class="nav-btn active" title="Routine">
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle cx="8" cy="7" r="2.2"></circle>
              <path d="M5.2 11.3l2.6-1.3 2.4 1.9-1.7 2.4 2.3 2.1-1.5 1.7-3.1-2.7z"></path>
              <path d="M13.7 8.2h5.9v2h-5.9z"></path>
              <path d="M13.7 12h5.9v2h-5.9z"></path>
              <path d="M13.7 15.8h5.9v2h-5.9z"></path>
            </svg>
          </span>
          <span class="nav-label">Routine</span>
        </button>
        <button data-view="history-view" class="nav-btn" title="History">
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M4 18h16v2H4z"></path>
              <path d="M6 10h2v8H6z"></path>
              <path d="M11 6h2v12h-2z"></path>
              <path d="M16 12h2v6h-2z"></path>
            </svg>
          </span>
          <span class="nav-label">History</span>
        </button>
        <button data-view="settings-view" class="nav-btn" title="Settings">
          <span class="nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M4 6.5h16v2H4z"></path>
              <circle cx="9" cy="7.5" r="2"></circle>
              <path d="M4 11h16v2H4z"></path>
              <circle cx="15" cy="12" r="2"></circle>
              <path d="M4 15.5h16v2H4z"></path>
              <circle cx="11" cy="16.5" r="2"></circle>
            </svg>
          </span>
          <span class="nav-label">Settings</span>
        </button>
      </nav>
      <div id="update-toast" class="toast" hidden aria-live="polite"></div>
    </div>

    <script type="module" src="./src/app.js"></script>
  </body>
</html>
